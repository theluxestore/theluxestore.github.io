<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Luxe Store</title>
  <meta name="description" content="Premium Online Shopping at The Luxe Store" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .btn { background:#ffd700;color:#000;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700; }
    .btn-small { padding:6px 10px;font-size:13px;border-radius:6px; }
    .cart-line { display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.05); }
  </style>
</head>
<body>
  <header class="header">
    <div class="inner">
      <div class="brand">
        <div class="logo">L</div>
        <div>
          <div style="font-weight:700">The Luxe Store</div>
          <div style="font-size:12px;color:#bbb">Premium &amp; Exclusive</div>
        </div>
      </div>
      <nav>
        <a href="#collections">Collections</a>
        <a href="#about">About</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <section class="hero" id="home">
    <div class="hero-inner">
      <h1>Premium Online Shopping at THE LUXE</h1>
      <p>Shop Top Brands â€” Electronics, Fashion, Cosmetics & More</p>
      <a class="btn" href="#collections">Shop Now</a>
    </div>
  </section>

  <!-- Featured (optional static) -->
  <section class="section" id="collections">
    <div class="container"><h2>Featured</h2></div>
  </section>

  <!-- Dynamic Products -->
  <section class="section" id="dynamic-products">
    <div class="container">
      <h2>Our Latest Products</h2>
      <div id="products"></div>
    </div>
  </section>

  <!-- CART SECTION -->
  <section class="section" id="cart">
    <div class="container">
      <h2>Your Cart ðŸ›’</h2>
      <div id="cart-items" style="background:#111;padding:15px;border-radius:10px;color:white;margin-bottom:10px;"></div>
      <div id="cart-total" style="color:gold;font-weight:bold;margin-bottom:8px;">Total: Rs 0</div>
      <div style="display:flex;gap:10px;">
        <button class="btn" onclick="checkoutOrder()">Checkout</button>
        <button class="btn btn-small" style="background:#333;color:#fff;" onclick="clearCart()">Clear Cart</button>
      </div>
      <div id="order-message" style="margin-top:10px;color:#8f8;"></div>
    </div>
  </section>

  <footer>
    Â© 2025 The Luxe Store â€” All Rights Reserved.
  </footer>

  <!-- Supabase + Logic -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // ---------- CONFIG ----------
    const SUPABASE_URL = 'https://meqbcuidksqwdmaqwvwc.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1lcWJjdWlka3Nxd2RtYXF3dndjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0MjU2MjMsImV4cCI6MjA3NjAwMTYyM30.HYdIGrRMwlOkiQkYBsUcIvPeVF2oAAUNPj8V-8PKuvs';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ---------- VARIABLES ----------
    let cart = [];

    // ---------- FUNCTIONS ----------

    // Load products from Supabase
    async function loadProducts() {
      const { data, error } = await supabase.from('products').select('*').order('id');
      if (error) { console.error('Error loading products', error); return; }
      renderProducts(data);
    }

    // Render product grid
    function renderProducts(products) {
      const root = document.getElementById('products');
      root.innerHTML = '';
      const grid = document.createElement('div');
      grid.style.display = 'grid';
      grid.style.gridTemplateColumns = 'repeat(auto-fit,minmax(250px,1fr))';
      grid.style.gap = '20px';
      grid.style.padding = '20px';
      products.forEach(p => {
        const card = document.createElement('div');
        card.style.background = '#111';
        card.style.border = '1px solid gold';
        card.style.borderRadius = '12px';
        card.style.padding = '12px';
        card.style.textAlign = 'center';
        const price = Number(p.price) || 0;
        card.innerHTML = `
          <img src="${p.image}" width="220" height="220" style="border-radius:10px;margin-bottom:10px;object-fit:cover;"/>
          <strong style="color:#ffd700">${escapeHtml(p.name)}</strong><br/>
          <span style="color:#e6c200">Rs ${price}</span><br/>
          <p style="color:rgba(255,255,255,0.7)">${escapeHtml(p.description || '')}</p>
          <button class="btn" onclick="addToCart('${p.id}','${escapeJs(p.name)}',${price})">Add to Cart</button>
        `;
        grid.appendChild(card);
      });
      root.appendChild(grid);
    }

    // Safe text functions
    function escapeHtml(s){return s? s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])):'';}
    function escapeJs(s){return (s||'').replace(/'/g,"\\'").replace(/"/g,'\\"');}

    // --- CART OPERATIONS ---
    function addToCart(id,name,price){
      const existing=cart.find(x=>x.id===id);
      if(existing) existing.qty++; else cart.push({id,name,price,qty:1});
      updateCart();
    }
    function removeFromCart(id){ cart=cart.filter(x=>x.id!==id); updateCart(); }
    function increaseQty(id){ const it=cart.find(x=>x.id===id); if(it){it.qty++; updateCart();}}
    function decreaseQty(id){ const it=cart.find(x=>x.id===id); if(it){it.qty=Math.max(1,it.qty-1); updateCart();}}
    function clearCart(){ if(confirm('Clear all items?')){cart=[]; updateCart();}}

    // Update cart display
    function updateCart(){
      const box=document.getElementById('cart-items');
      box.innerHTML='';
      let total=0;
      if(cart.length===0){ box.innerHTML='<div style="color:#aaa">Your cart is empty.</div>'; }
      else{
        cart.forEach(i=>{
          total+=i.price*i.qty;
          const line=document.createElement('div');
          line.className='cart-line';
          line.innerHTML=`
            <div>${escapeHtml(i.name)} <small style="color:#bbb">x${i.qty}</small></div>
            <div>
              <span>Rs ${i.price*i.qty}</span>
              <button class="btn-small" style="background:#444;color:#fff;margin-left:5px;" onclick="decreaseQty('${i.id}')">-</button>
              <button class="btn-small" style="background:#444;color:#fff;margin-left:5px;" onclick="increaseQty('${i.id}')">+</button>
              <button class="btn-small" style="background:#c33;color:#fff;margin-left:5px;" onclick="removeFromCart('${i.id}')">Remove</button>
            </div>`;
          box.appendChild(line);
        });
      }
      document.getElementById('cart-total').innerText='Total: Rs '+total;
    }

    // Checkout: save order in Supabase
    async function checkoutOrder(){
      if(cart.length===0){alert('Cart is empty');return;}
      const name=prompt('Enter your name:'); if(!name) return;
      const email=prompt('Enter your email (optional):');
      const total=cart.reduce((s,i)=>s+i.price*i.qty,0);
      const order={items:cart,total,customer_name:name,customer_email:email||null};
      const {data,error}=await supabase.from('orders').insert([order]).select();
      if(error){alert('Error saving order!');console.error(error);return;}
      document.getElementById('order-message').innerText='âœ… Order Placed! Order ID: '+data[0].id;
      cart=[]; updateCart();
    }

    // ---------- INITIAL CALL ----------
    loadProducts();
    updateCart();
  </script>
</body>
</html>
